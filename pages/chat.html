<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI Study Assistant</title>
    <!-- Inter Font and Bootstrap 5 CDN -->
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
    />

    <style>
      /* --- Global Layout Variables and Styles --- */
      :root {
        --navbar-height: 56px; /* Standard Bootstrap navbar height */
        --input-area-height: 100px;
      }

      body {
        font-family: "Inter", sans-serif;
        background-color: #f4f6f9;
        margin: 0;
        padding: 0;
        display: flex;
        flex-direction: column;
        height: 100vh;
        overflow-x: hidden; /* Prevent horizontal body scrolling */
      }

      /* Fixed Main Navbar */
      .main-site-header {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        height: var(--navbar-height);
        z-index: 1030;
      }

      /* Main content container must clear the fixed navbar */
      .main-layout-container {
        padding-top: var(--navbar-height);
        flex-grow: 1;
        overflow-y: auto; /* Enable scrolling for the whole main area on mobile/tablets */
      }

      /* 2. Fixed Sidebar for large screens (Lg and up) */
      @media (min-width: 992px) {
        .sidebar-fixed {
          height: calc(
            100vh - var(--navbar-height)
          ); /* Full height below the navbar */
          position: fixed;
          top: var(--navbar-height);
          left: 0;
          z-index: 1020;
          overflow-y: auto;
          background-color: #ffffff;
          border-right: 1px solid #e9ecef;
          padding-right: 0 !important;
        }

        /* 3. Push the main content area to the right to accommodate the fixed sidebar (col-lg-2 = 16.666%) */
        .main-content-area {
          margin-left: 16.666%; /* Matches the width of col-lg-2 */
        }
      }
      
      /* --- Chat Specific Styles --- */

      /* Chat container needs to manage its own scrolling and padding for the fixed input */
      #chat-container {
        display: flex;
        flex-direction: column;
        height: 100%;
        min-height: calc(100vh - var(--navbar-height)); /* Ensure it takes at least the viewport height below the main navbar */
        position: relative;
      }

      /* Chat Messages Window */
      #chat-window {
        flex-grow: 1;
        overflow-y: auto;
        padding: 1rem;
        /* Padding bottom to clear the fixed input area */
        padding-bottom: calc(var(--input-area-height) + 1rem); 
        scroll-behavior: smooth;
        max-width: 100%; /* Ensure responsiveness within its container */
      }

      /* Fixed Input Area */
      #input-area {
        position: fixed;
        bottom: 0;
        /* On desktop, align left edge with the chat column's inner content */
        left: 0; 
        right: 0;
        height: var(--input-area-height);
        background-color: #ffffff;
        border-top: 1px solid #e9ecef;
        box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05);
        display: flex;
        align-items: center;
        z-index: 10;
        padding: 0 1rem;
        
      }
      /* Crucial: On large screens, adjust the left margin/width of the fixed input area to align with the col-lg-10 */
      @media (min-width: 992px) {
        #input-area {
          /* Calculate position relative to the main-content-area start */
          left: 16.666%; 
          /* Calculate the remaining width for the input area */
          width: 83.334%;
        }
      }

      /* Textarea styling for responsive height */
      #user-input {
        max-height: 80px;
        resize: none;
        transition: height 0.2s ease;
        border-radius: 0.75rem;
      }

      /* Message Bubble Styling */
      .message-bubble {
        max-width: 85%;
        padding: 0.75rem 1rem;
        margin-bottom: 0.75rem;
        border-radius: 1rem;
        line-height: 1.4;
        white-space: pre-wrap;
        word-wrap: break-word;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
      }

      .user-message {
        background-color: #0d6efd;
        color: white;
        margin-left: auto;
        border-bottom-right-radius: 0.25rem;
      }

      .bot-message {
        background-color: #ffffff;
        border: 1px solid #e9ecef;
        color: #343a40;
        margin-right: auto;
        border-bottom-left-radius: 0.25rem;
      }
      
      .bot-message .sources {
        margin-top: 0.75rem;
        padding-top: 0.5rem;
        border-top: 1px solid #f0f0f0;
      }

      /* Loading Indicator */
      .loading-dots div {
        width: 8px;
        height: 8px;
        margin: 0 2px;
        background-color: #0d6efd;
        border-radius: 50%;
        display: inline-block;
        animation: bounce 1.4s infinite ease-in-out both;
      }
      .loading-dots div:nth-child(1) { animation-delay: -0.32s; }
      .loading-dots div:nth-child(2) { animation-delay: -0.16s; }
      @keyframes bounce {
        0%, 80%, 100% { transform: scale(0); }
        40% { transform: scale(1); }
      }

      /* Source/Citation Style */
      .sources a {
        display: block;
        font-size: 0.75rem;
        color: #6c757d;
        text-decoration: none;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        line-height: 1.2;
      }
      .sources a:hover {
        color: #0d6efd;
      }

      /* Sidebar Aesthetics */
      .nav-link {
        color: #343a40 !important; 
        padding-left: 0.5rem;
        padding-right: 0.5rem;
      }
      .nav-link:hover {
        color: #0d6efd !important;
      }
    </style>
  </head>
  <body>
    <!-- Offcanvas Sidebar for Mobile (d-lg-none) -->
    <div
      class="offcanvas offcanvas-start bg-light"
      tabindex="-1"
      id="sidebarOffcanvas"
      aria-labelledby="sidebarOffcanvasLabel"
    >
      <div class="offcanvas-header bg-primary text-white shadow-sm">
        <h5 class="offcanvas-title" id="sidebarOffcanvasLabel">
          <i class="bi bi-mortarboard-fill me-2"></i>Danh mục
        </h5>
        <button
          type="button"
          class="btn-close btn-close-white"
          data-bs-dismiss="offcanvas"
          aria-label="Close"
        ></button>
      </div>
      <div class="offcanvas-body">
        <nav class="p-3">
          <h5 class="text-primary mb-3">Danh mục & Bộ lọc</h5>
          <ul class="nav flex-column">
            <li class="nav-item fw-bold text-secondary mb-2">Môn học</li>
            <li class="nav-item mb-1">
              <a class="nav-link" href="./math.html">Toán học</a>
            </li>
            <li class="nav-item mb-1">
              <a class="nav-link" href="./english.html">Tiếng Anh</a>
            </li>
            <li class="nav-item mb-1">
              <a class="nav-link" href="./van.html">Ngữ Văn</a>
            </li>
          </ul>
        </nav>
      </div>
    </div>

    <!-- Main Fixed Header (Navbar) -->
    <header class="main-site-header">
      <nav
        class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top shadow"
      >
        <div class="container-fluid">
          <!-- Toggle button for mobile sidebar -->
          <button
            class="btn btn-outline-light d-lg-none me-2"
            type="button"
            data-bs-toggle="offcanvas"
            data-bs-target="#sidebarOffcanvas"
            aria-controls="sidebarOffcanvas"
            aria-label="Toggle navigation"
          >
            <span class="navbar-toggler-icon"></span>
          </button>

          <a class="navbar-brand fw-bold" href="#">
            <i class="bi bi-mortarboard-fill"></i> Study 9+
          </a>

         <form class="d-flex mx-auto d-none d-md-flex" style="width: 400px" id="search-form">
            <input
              class="form-control me-2 rounded-pill"
              type="search"
              placeholder="Tìm kiếm tài liệu, khóa học..."
              aria-label="Search"
            />
            <button class="btn btn-warning rounded-pill" type="submit">
              Tìm
            </button>
          </form>

          <div class="d-flex ms-auto">
            <a
              href="./account.html"
              class="btn btn-outline-light me-2 d-none  rounded-pill"
              id="account-btn"
              >abc@gmail.com</a
            >
            <a
              href="./login.html"
              class="btn btn-warning rounded-pill"
              id="login-btn"
              >Đăng nhập</a
            >
          </div>
        </div>
      </nav>
    </header>

    <!-- Main Content Layout Container -->
    <main class="main-layout-container">
      <div class="container-fluid p-0">
        <div class="row g-0">
          <!-- Desktop Sidebar (d-none d-lg-block) - Uses custom fixed styling -->
          <div class="col-lg-2 d-none d-lg-block sidebar-fixed">
            <nav class="pt-4 px-3">
              <h5 class="text-primary mb-3 fw-bold">Danh mục & Bộ lọc</h5>
              <ul class="nav flex-column">
                <li class="nav-item fw-bold text-secondary mb-2">Môn học</li>
                <li class="nav-item mb-1">
                  <a class="nav-link" href="./math.html">Toán học</a>
                </li>
                <li class="nav-item mb-1">
                  <a class="nav-link" href="./english.html">Tiếng Anh</a>
                </li>
                <li class="nav-item mb-1">
                  <a class="nav-link" href="./van.html">Ngữ Văn</a>
                </li>
              </ul>

              <div class="mt-4 pt-3 border-top">
                <h5 class="text-primary mb-3 fw-bold">Khác</h5>
                <ul class="nav flex-column">
                  <li class="nav-item mb-1">
                    <!-- Current Page Link -->
                    <a class="nav-link active fw-bold bg-light" href="./chat.html">
                      <i class="bi bi-robot me-1"></i> Hỏi AI
                    </a>
                  </li>
                  <li class="nav-item mb-1">
                    <a class="nav-link" href="./account.html"
                      >Tài khoản của tôi</a
                    >
                  </li>
                  <li class="nav-item mb-1">
                    <a class="nav-link" href="../pages/add.html">Thêm tài liệu</a>
                  </li>
                </ul>
              </div>
            </nav>
          </div>

          <!-- Main Chat Content Area - Pushed over by custom CSS on desktop -->
          <div class="col-12 col-lg-10 main-content-area">
            <div id="chat-container">
              <!-- Non-fixed Chat Title Bar (now scrolls with content) -->
              <div class="d-flex justify-content-between align-items-center p-3 bg-white border-bottom shadow-sm sticky-top">
                <h4 class="mb-0 text-primary">
                  <i class="bi bi-robot me-2"></i>AI Study Assistant
                </h4>
                <button
                  class="btn btn-warning btn-sm rounded-pill"
                  onclick="clearChat()"
                >
                  <i class="bi bi-trash"></i> Bắt đầu lại
                </button>
              </div>

              <!-- Chat Messages Window -->
              <div id="chat-window" class="container">
                <!-- Initial Welcome Message (defined in JS for consistency) -->
              </div>

              <!-- Fixed Input Area (Positioned relative to viewport, adjusted by CSS) -->
              <div id="input-area" class="container">
                <form class="w-100 d-flex" onsubmit="sendMessage(event)">
                  <textarea
                    id="user-input"
                    class="form-control me-3"
                    rows="1"
                    placeholder="Nhập câu hỏi của bạn..."
                    required
                    onkeydown="handleKey(event)"
                  ></textarea>
                  <button
                    id="send-button"
                    type="submit"
                    class="btn btn-primary rounded-pill px-4"
                    disabled
                  >
                    <i class="bi bi-send-fill"></i>
                  </button>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- Bootstrap JavaScript Bundle -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      crossorigin="anonymous"
    ></script>
       <script src="../js/nav.js"></script>
       <script src="../js/gemini.js"></script>

  </body>
</html>
